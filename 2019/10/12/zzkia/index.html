<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="周左左个人博客"><meta name="theme-color" content="#795548"><title>诺基亚短信图片生成 | 白玉为堂金为马</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">诺基亚短信图片生成</h1><a id="logo" href="/.">白玉为堂金为马</a><p class="description">70%有趣的灵魂</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">诺基亚短信图片生成</h1><div class="post-meta">Oct 12, 2019<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span></div><div class="post-content"><p>最近经常会在群聊中看见这样的老式手机短信的表情包，让我十分感兴趣。<br><img src="http://static.noddl.me/15708598290140.jpg" alt></p>
<p>我也想做一些这样的图片去逗逗损友，于是我搜了一圈，虽然网上有现成的生成器，但是广告比较多。于是还想自己做一个，顺便练练Image Processing。</p>
<p>一开始本打算在Web Side搞定的，但是发现我对canvas绘图并不熟悉，最后转向了靠谱的Pillow。</p>
<h2 id="Photoshop处理原始图片"><a href="#Photoshop处理原始图片" class="headerlink" title="Photoshop处理原始图片"></a>Photoshop处理原始图片</h2><p>在网上搜索了一大圈以后，找到了一张比较清晰且干净的原始图片。然后经过PS一番处理，得到一张空白短信图。<br><img src="http://static.noddl.me/final.png" alt="Origin"></p>
<h2 id="寻找像素风Font"><a href="#寻找像素风Font" class="headerlink" title="寻找像素风Font"></a>寻找像素风Font</h2><p>图片中可以清晰地看见手机屏上小小的晶格，那么肯定要用像素风格的字体来绘制Text。</p>
<h2 id="Pillow-绘制"><a href="#Pillow-绘制" class="headerlink" title="Pillow 绘制"></a>Pillow 绘制</h2><p>首先打开原始图片:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im = Image.open(<span class="string">"images/3.png"</span>) <span class="comment"># 打开图片</span></span><br></pre></td></tr></table></figure>
<p>随后绘制Rotated Text:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">'zzkia'</span></span><br><span class="line">width, height = font.getsize(text)</span><br><span class="line">image2 = Image.new(<span class="string">"RGBA"</span>, (width, height))</span><br><span class="line">draw2 = ImageDraw.Draw(image2)</span><br><span class="line">draw2.text((<span class="number">0</span>, <span class="number">0</span>), text=text, font=font, fill=subtitle_color)</span><br><span class="line">image2 = image2.rotate(line_rotate, expand=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">px, py = subtitle_pos</span><br><span class="line">sx, sy = image2.size</span><br><span class="line">im.paste(image2, (px, py, px + sx, py + sy), image2)</span><br></pre></td></tr></table></figure>
<p>我们发现短信中包含正文以及右上角的字数显示，于是改变字体颜色，再次绘制即可。</p>
<p>当然绘制正文的时候要注意换行，不能让文字超出屏幕的边界。我采用的方法是使用Python标准款中的<code>textwrap</code>。先限定每行max length，把String类型的text文本转换为List<string>，再加入gap属性增加每行文字之间间隙，最后一行行绘制文本。具体如何实现可以在源代码中查看</string></p>
<h2 id="Dockerize"><a href="#Dockerize" class="headerlink" title="Dockerize"></a>Dockerize</h2><p>因为既有Python Server Side也有Web Side的Serives，所以最后用Docker compose编排一下进行发布，也能提供一个外部的访问。</p>
<h1 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h1><p>可以访问Github查看源代码: <a href="https://github.com/dcalsky/zzkia" target="_blank" rel="noopener">https://github.com/dcalsky/zzkia</a><br>也可以直接进入: <a href="https://zzkia.noddl.me:8020" target="_blank" rel="noopener">https://zzkia.noddl.me:8020</a></p>
<h1 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h1><p><img src="http://static.noddl.me/demo.png" alt="demo"></p>
</div><div class="tags"></div><div class="post-nav"><a class="next" href="/2019/10/05/ukelele/">Ukelele伴奏 父亲节排练</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/摄影/">摄影</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/诗/">诗</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.zhihu.com/people/dcalsky" title="知乎" target="_blank">知乎</a><ul></ul><a href="https://github.com/dcalsky" title="Github" target="_blank">Github</a><ul></ul><a href="mailto:dcalsky@gmail.com" title="电子邮箱" target="_blank">电子邮箱</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">白玉为堂金为马.</a><p>沪ICP备15027189号-2</p></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>